<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding favicon -->
    

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      Home
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Home</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><ul><li class="menu-li"><a href='https://gh.nes.science/nes-test/' class=' menu-link' id='' target='_blank'>Github</a></li></ul><div class="accordion collapsed" id="2958432" > <h3 class="accordion-heading">Classes<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=992147><div class="accordion-heading child"><a href="JasmineMatchers.html">JasmineMatchers</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="JasmineMatchers.html#.installMatchers">installMatchers</a></li><li data-type='method'><a href="JasmineMatchers.html#.toBeIdenticalToImage">toBeIdenticalToImage</a></li><li data-type='method'><a href="JasmineMatchers.html#.toBeSimilarToImage">toBeSimilarToImage</a></li></ul></li><li class="accordion collapsed child" id=6055658><div class="accordion-heading child"><a href="NesEmulator.html">NesEmulator</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="NesEmulator.html#ensureEmulatorAvailable">ensureEmulatorAvailable</a></li><li data-type='method'><a href="NesEmulator.html#getByteRange">getByteRange</a></li><li data-type='method'><a href="NesEmulator.html#getByteValue">getByteValue</a></li><li data-type='method'><a href="NesEmulator.html#getNumericAddress">getNumericAddress</a></li><li data-type='method'><a href="NesEmulator.html#getPpuByteValue">getPpuByteValue</a></li><li data-type='method'><a href="NesEmulator.html#getPpuWordValue">getPpuWordValue</a></li><li data-type='method'><a href="NesEmulator.html#getScreenshotPath">getScreenshotPath</a></li><li data-type='method'><a href="NesEmulator.html#getWordValue">getWordValue</a></li><li data-type='method'><a href="NesEmulator.html#runCpuFrames">runCpuFrames</a></li><li data-type='method'><a href="NesEmulator.html#runLua">runLua</a></li><li data-type='method'><a href="NesEmulator.html#sendInput">sendInput</a></li><li data-type='method'><a href="NesEmulator.html#setMemoryByteValue">setMemoryByteValue</a></li><li data-type='method'><a href="NesEmulator.html#setMemoryWordValue">setMemoryWordValue</a></li><li data-type='method'><a href="NesEmulator.html#setPpuByteValue">setPpuByteValue</a></li><li data-type='method'><a href="NesEmulator.html#setPpuWordValue">setPpuWordValue</a></li><li data-type='method'><a href="NesEmulator.html#setPrgByteValue">setPrgByteValue</a></li><li data-type='method'><a href="NesEmulator.html#setPrgWordValue">setPrgWordValue</a></li><li data-type='method'><a href="NesEmulator.html#start">start</a></li><li data-type='method'><a href="NesEmulator.html#stop">stop</a></li><li data-type='method'><a href="NesEmulator.html#takeScreenshot">takeScreenshot</a></li></ul></li><li class="accordion collapsed child" id=6365672><div class="accordion-heading child"><a href="NesRomFile.html">NesRomFile</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="NesRomFile.html#getIncludesBatteryBackedRam">getIncludesBatteryBackedRam</a></li><li data-type='method'><a href="NesRomFile.html#getIncludesFourScreenVram">getIncludesFourScreenVram</a></li><li data-type='method'><a href="NesRomFile.html#getMapper">getMapper</a></li><li data-type='method'><a href="NesRomFile.html#getMirroring">getMirroring</a></li><li data-type='method'><a href="NesRomFile.html#hasValidHeader">hasValidHeader</a></li></ul></li></ul> </div><div class="accordion collapsed" id="4318285" > <h3 class="accordion-heading">Tutorials<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="tutorial-Accessing Variables By Name.html">Accessing Variables By Name</a></li></ul> </div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      

      



    









    


    <section class="readme">
        <article><h1>nes-test</h1>
<p>A simple <a href="https://jasmine.github.io/api/4.0/matchers.html">jasmine</a> +
mesen-based test runner for the NES. Validate that your generated roms have
the proper size/signature, and do the right things when you run them.</p>
<p><strong>Note</strong>: This is a <em>very</em> early project! If you find this thing useful, <em>please</em> let me know!
If I see people using this I'll be much more likely to carry the project forward.</p>
<h2>Features</h2>
<ul>
<li>Write unit tests using jasmine and javascript</li>
<li>Inspect memory locations during game execution</li>
<li>Use labels and variables defined in assembly/C when debug information is configured</li>
<li>Compare screenshots with expected screenshots</li>
<li>Inspect rom file for correctness (header is present, rom length matches header)</li>
<li>Support for both windows and linux! (Mac support will come if mesen is ever officially supported there)</li>
<li>Distributed as a single binary, or an npm module</li>
</ul>
<h2>Quick Links</h2>
<ul>
<li><a href="https://gh.nes.science/nes-test/releases">Downloads</a></li>
<li><a href="https://nes-test.nes.science">API Documentation</a></li>
<li><a href="https://gh.nes.science/nes-test/tree/main/examples">Example Usage</a></li>
<li><a href="#special-notes-for-linux">Linux Notes</a></li>
</ul>
<h2>Example tests</h2>
<p>More examples can be found in <a href="https://gh.nes.science/nes-test/tree/main/examples">the examples/ folder</a>!</p>
<pre class="prettyprint source lang-javascript"><code>
it('Validates that this is a valid NES rom', async () => {
    // Rom paths are relative to the test script
    romData = new NesRomFile('./data/working-nrom.nes');
    expect(romData.hasValidHeader()).toEqual(true);
});
    

it('gameState C variable starts at 0, then is updated after you dismiss the menu', async () => {

    // Create a new emulator instance
    emulator = new NesEmulator('./data/working-nrom.nes');
    // Open the emulator
    emulator.start();

    // Check the initial state of gameState
    expect(await emulator.getByteValue('gameState')).toEqual(0)

    // Wait for input to start being accepted, then press start
    await emulator.runCpuFrames(60);
    await emulator.sendInput({start: true});
    await emulator.runCpuFrames(30);

    // Validate gameState was properly updated
    expect(await emulator.getByteValue('gameState')).toEqual(11);

    // Stop the emulator
    emulator.stop();
});
</code></pre>
<p>There are plenty of examples in the <a href="https://gh.nes.science/nes-test/tree/main/examples">examples/</a> folder.</p>
<h2>What if a test fails?</h2>
<p>You will get a list of the failed tests, along with a line number and reason for failure.</p>
<p><img src="./jsdoc/test_output.png" alt="Test Results"></p>
<h2>Installation</h2>
<p>Download the binary for your operating system from the github releases page.</p>
<p>https://gh.nes.science/nes-test/releases</p>
<p>Put this somewhere on your system, then create a folder for your tests. (You can also copy the examples folder from this repo to start!)</p>
<p>Run the program by calling it on the command line, with the relative path to your tests.</p>
<pre class="prettyprint source lang-sh"><code>./nes-test-win ./examples
</code></pre>
<h3>Major rewrite version 0.3</h3>
<p>0.3 is a complete rewrite of the features of this library. Old code will not work!
0.3 restructures the library to allow better passing of data to/from the emulator. It also allows much more intuitive
test writing. It also installs Mesen automatically, so no manual setup is required!</p>
<p>If you need 0.2, here is a link:</p>
<p><a href="https://gh.nes.science/nes-test/tree/v0.2.1">0.2 version</a></p>
<h3>Special notes for linux</h3>
<p>This program will work as expected with linux, however Mesen has a few special requirements to get it going. Namely, you'll need the
following packages, which may be installed using apt or a similar package manager.</p>
<ul>
<li>mono-complete</li>
<li>libsdl2-2.0</li>
<li>gnome-themes-standard (You might be able to get away without this one if you only ever use the test runner)</li>
</ul>
<p>If you run into issues, try downloading a copy of Mesen manually and getting it to work. The tool should inherit any
changes you make to your system.</p>
<p>Find more information on running Mesen on linux here: https://github.com/SourMesen/Mesen#ubuntu</p>
<p>Otherwise follow all of the instructions in the above section. Mesen will be automatically downloaded in a config directory
when you first run the tests.</p>
<h2>Examples</h2>
<p>There are plenty of examples with documentation in the <a href="https://gh.nes.science/nes-test/tree/main/examples">examples folder</a></p>
<h2>Documentation</h2>
<p>All API methods are documented on <a href="https://nes-test.nes.science/">the github pages site</a></p>
<h2>Configuration</h2>
<p>There is not much configuration for this module yet, but a few environment variables can customize behavior to help your debugging:</p>
<ul>
<li><code>DEBUG_OPEN_MESEN</code> - Set this to <code>true</code> to open mesen and run a test in the script runner. (Note: enable a single test with <code>fit()</code> or behavior may be unpredictable!)</li>
</ul>
<h2>Gotchas with jasmine</h2>
<ul>
<li>Tests in jasmine time out after 5 seconds by default. If you need longer, you can set the <code>DEFAULT_TIMEOUT_INTERVAL</code> environment variable when running the tool. (Values are in milliseconds)</li>
<li>The <code>NesEmulator</code> class methods are almost all asynchronous, so be sure to prefix them with <code>await</code>, or you could encounter weird bugs.</li>
</ul>
<h2>Potential future features</h2>
<ul>
<li>Allow installs as a node module. (Note: this might work now, if you're adventurous feel free to try!)</li>
<li>Better test roms, with source</li>
<li>Instructions for running this in continuous integration environments
<ul>
<li>The short version is, I probably need to publish to npm, then have users run <code>npx nes-test</code></li>
<li>For now you could download the binary directly and run it as usual</li>
</ul>
</li>
</ul>
<h2>Contact</h2>
<p>Free to <a href="mailto:admin@cpprograms.net">email me</a> or create Github issues.</p>
<p>I want to hear from you! Also if you'd like to contribute, submit an issue or a PR! I don't have many contribution guidelines (yet!)
but if you've got something you want to see, I'm all ears.</p></article>
    </section>






    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"JasmineMatchers","link":"<a href=\"JasmineMatchers.html\">JasmineMatchers</a>"},{"title":"JasmineMatchers.installMatchers","link":"<a href=\"JasmineMatchers.html#.installMatchers\">JasmineMatchers.installMatchers &rtrif; undefined</a>"},{"title":"JasmineMatchers.toBeIdenticalToImage","link":"<a href=\"JasmineMatchers.html#.toBeIdenticalToImage\">JasmineMatchers.toBeIdenticalToImage &rtrif; undefined</a>"},{"title":"JasmineMatchers.toBeSimilarToImage","link":"<a href=\"JasmineMatchers.html#.toBeSimilarToImage\">JasmineMatchers.toBeSimilarToImage &rtrif; undefined</a>"},{"title":"NesEmulator","link":"<a href=\"NesEmulator.html\">NesEmulator</a>"},{"title":"NesEmulator#ensureEmulatorAvailable","link":"<a href=\"NesEmulator.html#ensureEmulatorAvailable\">NesEmulator &rtrif; ensureEmulatorAvailable</a>"},{"title":"NesEmulator#getByteRange","link":"<a href=\"NesEmulator.html#getByteRange\">NesEmulator &rtrif; getByteRange</a>"},{"title":"NesEmulator#getByteValue","link":"<a href=\"NesEmulator.html#getByteValue\">NesEmulator &rtrif; getByteValue</a>"},{"title":"NesEmulator#getNumericAddress","link":"<a href=\"NesEmulator.html#getNumericAddress\">NesEmulator &rtrif; getNumericAddress</a>"},{"title":"NesEmulator#getPpuByteValue","link":"<a href=\"NesEmulator.html#getPpuByteValue\">NesEmulator &rtrif; getPpuByteValue</a>"},{"title":"NesEmulator#getPpuWordValue","link":"<a href=\"NesEmulator.html#getPpuWordValue\">NesEmulator &rtrif; getPpuWordValue</a>"},{"title":"NesEmulator#getScreenshotPath","link":"<a href=\"NesEmulator.html#getScreenshotPath\">NesEmulator &rtrif; getScreenshotPath</a>"},{"title":"NesEmulator#getWordValue","link":"<a href=\"NesEmulator.html#getWordValue\">NesEmulator &rtrif; getWordValue</a>"},{"title":"NesEmulator#runCpuFrames","link":"<a href=\"NesEmulator.html#runCpuFrames\">NesEmulator &rtrif; runCpuFrames</a>"},{"title":"NesEmulator#runLua","link":"<a href=\"NesEmulator.html#runLua\">NesEmulator &rtrif; runLua</a>"},{"title":"NesEmulator#sendInput","link":"<a href=\"NesEmulator.html#sendInput\">NesEmulator &rtrif; sendInput</a>"},{"title":"NesEmulator#setMemoryByteValue","link":"<a href=\"NesEmulator.html#setMemoryByteValue\">NesEmulator &rtrif; setMemoryByteValue</a>"},{"title":"NesEmulator#setMemoryWordValue","link":"<a href=\"NesEmulator.html#setMemoryWordValue\">NesEmulator &rtrif; setMemoryWordValue</a>"},{"title":"NesEmulator#setPpuByteValue","link":"<a href=\"NesEmulator.html#setPpuByteValue\">NesEmulator &rtrif; setPpuByteValue</a>"},{"title":"NesEmulator#setPpuWordValue","link":"<a href=\"NesEmulator.html#setPpuWordValue\">NesEmulator &rtrif; setPpuWordValue</a>"},{"title":"NesEmulator#setPrgByteValue","link":"<a href=\"NesEmulator.html#setPrgByteValue\">NesEmulator &rtrif; setPrgByteValue</a>"},{"title":"NesEmulator#setPrgWordValue","link":"<a href=\"NesEmulator.html#setPrgWordValue\">NesEmulator &rtrif; setPrgWordValue</a>"},{"title":"NesEmulator#start","link":"<a href=\"NesEmulator.html#start\">NesEmulator &rtrif; start</a>"},{"title":"NesEmulator#stop","link":"<a href=\"NesEmulator.html#stop\">NesEmulator &rtrif; stop</a>"},{"title":"NesEmulator#takeScreenshot","link":"<a href=\"NesEmulator.html#takeScreenshot\">NesEmulator &rtrif; takeScreenshot</a>"},{"title":"NesRomFile","link":"<a href=\"NesRomFile.html\">NesRomFile</a>"},{"title":"NesRomFile#getIncludesBatteryBackedRam","link":"<a href=\"NesRomFile.html#getIncludesBatteryBackedRam\">NesRomFile &rtrif; getIncludesBatteryBackedRam</a>"},{"title":"NesRomFile#getIncludesFourScreenVram","link":"<a href=\"NesRomFile.html#getIncludesFourScreenVram\">NesRomFile &rtrif; getIncludesFourScreenVram</a>"},{"title":"NesRomFile#getMapper","link":"<a href=\"NesRomFile.html#getMapper\">NesRomFile &rtrif; getMapper</a>"},{"title":"NesRomFile#getMirroring","link":"<a href=\"NesRomFile.html#getMirroring\">NesRomFile &rtrif; getMirroring</a>"},{"title":"NesRomFile#hasValidHeader","link":"<a href=\"NesRomFile.html#hasValidHeader\">NesRomFile &rtrif; hasValidHeader</a>"},{"title":"Accessing Variables By Name","link":"Accessing Variables By Name"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    
    <script type="text/javascript">
        document.querySelectorAll('.accordion').forEach(e => toggleAccordion(e, true))
    </script>
    

    

    


  </body>

</html>